# VPN Manager - Guide de configuration üöÄ

## üìã Pr√©requis

- `openfortivpn` doit √™tre install√©
- Acc√®s sudo pour √©tablir les connexions VPN

## üîß Configuration

### 1. Obtenir les informations du serveur VPN

Pour chaque VPN, vous avez besoin de :
- **H√¥te et port** (ex: vpn.example.com:443)
- **Nom d'utilisateur**
- **Certificat SSL** (fingerprint SHA256)
- **Mot de passe**
- **Mode d'authentification** (password, 2fa ou saml)

### 2. R√©cup√©rer le certificat SSL

```bash
echo | openssl s_client -connect SERVEUR:PORT 2>/dev/null | openssl x509 -fingerprint -noout -sha256
```

Exemple de sortie :
```
SHA256 Fingerprint=4D:49:0E:C4:D0:4B:59:C6:C2:C0:6F:E5:A0:D5:74:89:44:AA:35:BD:DA:A5:C3:6A:86:8D:9B:2F:E7:6F:5F:42
```

Utilisez la valeur sans les `:` ‚Üí `4d490ec4d04b59c6c2c06fe5a0d5748944aa35bddaa5c36a868d9b2fe76f5f42`

### 3. Cr√©er un fichier de configuration openfortivpn

Dans `~/.vpn/configs/`, cr√©ez un fichier pour chaque VPN (ex: `mon-vpn.conf`) :

```properties
host = vpn.example.com
port = 443
username = votre.nom@example.com
password = votre_mot_de_passe_secret
trusted-cert = 4d490ec4d04b59c6c2c06fe5a0d5748944aa35bddaa5c36a868d9b2fe76f5f42
set-routes = 1
set-dns = 0
pppd-use-peerdns = 0
```

**Note** : Le mot de passe est directement dans le fichier .conf. Il sera prot√©g√© avec chmod 600.

### 4. D√©clarer le VPN dans vpns.conf

√âditez `~/.vpn/vpns.conf` et ajoutez une section :

**Pour un VPN avec mot de passe simple :**
```ini
[mon-vpn]
name = Mon VPN Corporate
auth = password
config = mon-vpn.conf
```

**Pour un VPN avec 2FA (FortiToken) :**
```ini
[vpn-prod]
name = Production VPN
auth = 2fa
config = vpn-prod.conf
```

**Pour un VPN avec SAML/SSO :**
```ini
[vpn-sso]
name = SSO VPN
auth = saml
saml_host = vpn.example.com:444
saml_cert = 166fe8f33b64afc49c64f6c632b409d6f4c204ff1e90ce81d1e7da7b98e3fbf1
```

## üöÄ Utilisation

### Lancer le menu interactif
```bash
~/vpn
```

### Commandes directes
```bash
~/vpn connect 1      # Se connecter au VPN #1
~/vpn status         # Voir le statut
~/vpn disconnect     # Se d√©connecter
~/vpn list           # Lister les VPNs
~/vpn help           # Aide
```

### Connexion rapide
```bash
~/vpn c 1    # Connecter au VPN #1
~/vpn d      # D√©connecter
~/vpn s      # Statut
```

## üìù Logs

```bash
# Logs g√©n√©raux
tail -f ~/.vpn/logs/vpn.log

# Logs d'une connexion sp√©cifique
tail -f ~/.vpn/logs/mon-vpn.log
```

## üîê S√©curit√©

- Les fichiers `.conf` contiennent des informations sensibles et sont prot√©g√©s (chmod 600)
- Les mots de passe ne sont jamais affich√©s dans les logs
- N'ajoutez jamais les fichiers `*.conf` √† votre gestionnaire de versions

## üÜò D√©pannage

### Connexion √©choue
1. V√©rifiez les logs : `tail -f ~/.vpn/logs/mon-vpn.log`
2. V√©rifiez le certificat SSL du serveur
3. Testez manuellement : `sudo openfortivpn -c ~/.vpn/configs/mon-vpn.conf`

### Interface r√©seau non cr√©√©e
- V√©rifiez que `pppd` est install√© : `which pppd`
- V√©rifiez les droits sudo

## üåü Fonctionnalit√©s

‚úÖ Multi-VPN : connectez-vous √† plusieurs VPNs simultan√©ment
‚úÖ 1 seule interface par VPN (pas d'interfaces fant√¥mes)
‚úÖ Support password, 2FA et SAML
‚úÖ Nettoyage automatique √† la d√©connexion
‚úÖ Logs d√©taill√©s pour le d√©pannage
‚úÖ Gestion de mots de passe s√©curis√©e
‚úÖ Menu interactif simple
